<!DOCTYPE html>
<html>
<head>
    <title>物件飛行軌跡 By Box2D</title>
    <script src="https://code.jquery.com/jquery-3.0.0.js"></script>
    <script src="https://code.createjs.com/easeljs-0.8.2.min.js"></script>
</head>
<body>
    <p>
        <button id="startBtn" onclick="start();">Start</button>
    </p>
    <canvas id="testCanvas" width="600" height="800"></canvas>
<div>

</div>

<script>
    document.querySelector('#startBtn').disabled = true;
    drawing = new Image();
    drawing.src = "icon.png"; // can also be a remote URL e.g. http://
    drawing.onload = function() {
        document.querySelector('#startBtn').disabled = false;
    };
</script>

<script>
    var canvas = document.querySelector('#testCanvas');
    canvas.style.backgroundColor = 'lightgrey';
    var ctx = canvas.getContext('2d');

    var drawPath = function(list, color){
        if(!color)
            color = 'blue';
        else
            color = 'red';
        ctx.beginPath();
        list.forEach(function(obj, idx, all){
            if(idx === 0 && all.length === 1)
                return ctx.moveTo(obj.x, obj.y);
            if(idx === 0)
                return ctx.moveTo(obj.x, obj.y);
            return ctx.lineTo(obj.x, obj.y);
        });
        ctx.lineWidth = .5;
        ctx.strokeStyle = color;
        ctx.stroke();  
    };
</script>
<script>
    // Ref: http://www.iforce2d.net/b2dtut/projected-trajectory#
    // h = starting height
    // v = starting velocity
    // a = acceleration (gravity, constant)
    // n = second
    //
    // So height after the nth time step is:
    // h(n) = h + nv + (n² + n)/2 * a
    var getYFromOrigin = function(n, h, sv, gravity){
        //velocity and gravity are given per second but we want time step values here
        // var t = 1 / 60.0; // seconds per time step (at 60fps)
        // sv = t * sv; // m/s
        // gravity = t * t * gravity; // m/s/s
        return h + n * sv + (n * n + n) * gravity * 0.5 ;
    };

    var getXFromOrigin = function(n, x, sv){
        return x + n * sv;
    };
</script>
<script>
    var aScale = 1;
    var gravity = 9.8 * aScale;
    var startAccelerate = -50 * aScale;  // f = ma, a = accelerate
    var startAccelerateX = 20 * aScale;
    var origin = {
        x: 10,
        y: canvas.height - 10
    };
    var path = [];
    path.push(origin);
    // 可分別推估出飛行時間與落點位置
    // >> fly 20 seconds or `fly if y < canvas.height`
    // >> for(var i = 0; i < 20; i += 0.1){
    for(var i = 0; path[path.length - 1].y < canvas.height; i += 0.1){
        let y = getYFromOrigin(i, origin.y, startAccelerate, gravity);
        let x = getXFromOrigin(i, origin.x, startAccelerateX);
        let pos = {
            t: i,
            x: x,
            y: y
        };
        path.push(pos);
        console.log(pos);
    };
</script>
<script>
    var fps = 60;
    createjs.Ticker.setFPS(fps);
    console.debug('CreateJS FPS->', createjs.Ticker.getFPS());
    createjs.Ticker.addEventListener("tick", fixedTick);
    function fixedTick(e){
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        // debugger;
        // var idx = parseInt(e.runTime / 100);
        // if(idx > path.length - 1)
        //     idx = path.length - 1;
        // console.debug("TICK!!!", e.delta);
        // drawPath(path.slice(0, idx));
        drawPath(path);
    };
</script>
</body>
</html>